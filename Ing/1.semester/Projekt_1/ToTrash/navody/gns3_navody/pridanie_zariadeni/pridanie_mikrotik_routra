Pridanie Mikrotik routra do GNS3 1.5.2 cez QEMU

1) Stiahneme si RouterOS image. Na stránke

http://www.mikrotik.com/download

v časti "x86" klikneme na ikonku diskety v riadku "CD image" a v stĺpci s aktuálnou verziou (Current).

2) Najprv musíme vytvoriť disk, z ktorého bude RouterOS bootovať. Disk sa dá vytvoriť buď v termináli alebo priamo v GNS3.

2.1) Vytvorenie disku v termináli:
qemu-img create -f qcow2 Mikrotik-hda.qcow2 512M

2.2) Vytvorenie disku v GNS3
-qemu-img binary: nechať predvolenú
-image format: qcow2
-preallocation: off
-cluster size: default
-lazy refcounts: vypnuté
-refcount entry size: default
-file location: necháme predvolenú; súbor sa uloží do priečinku "/home/$USER/GNS3/images/QEMU/"
-size: 512 MB

3) Vytvorený disk pre Mikrotik router musíme pripraviť pred použitím v simulácií. Teraz naň nainštalujeme RouterOS príkazom:

qemu-system-i386 -m 512 -enable-kvm -boot d -cdrom <cesta_k_routerOS_iso> <cesta_k_mikrotik_disku_vytvoreneho_v_predchadzajucom_kroku>

v našom prípade:

qemu-system-i386 -m 512 -enable-kvm -boot d -cdrom ~/Downloads/mikrotik-6.37.1.iso Mikrotik-hda.qcow2

4) Následne sa otvorí inštalačné menu RouterOS, v ktorom si môžeme vybrať balíčky na inštaláciu. Vyberieme všetky balíčky stlačením klávesy 'a'. Výber potvrdíme klávesou 'i'. Pri dotaze, či chceme zachovať pôvodnú konfiguráciu, ju odmietneme stlačením klávesy 'n' a pri dotaze "Continue?" stlačíme klávesu 'y' potvrtíme vymazanie pôvodnej konfigurácie. Začne sa proces partíciovania, formátovania a inštalácie balíčkov. Po dokončení operácie je potrebné reštartovať router stlačením klávesy 'Enter'. Po opätovnom nabootovaní ukončíme prácu s routrom stlačením klávesovej skratky "Ctrl + Alt + G" (uvoľnenie kurzora z virtuálnej mašiny) -> Machine -> Quit, resp. klávesovou skratkou "Ctrl + Alt + Q" (ukončenie virtuálnej mašiny)

5) Nainštalovaný RouterOS spustíme príkazom

qemu-system-i386 -m 512 -enable-kvm -boot c Mikrotik-hda.qcow2 -nographic -serial telnet::4444,server,nowait

Na router sa vieme pripojiť telnetom príkazom "telnet 127.0.0.1 4444". Do približne do 1-2 minút by sa po stlačení klávesy 'Enter' mala zobraziť prihlasovacia obrazovka. Prihlasovacie údaje sú:

Mikrotik Login: admin
Password: <bez hesla>

6) Teraz je RouterOS image pripravený pre GNS3 na vytvorenie Mikrotik routra. V GNS3 klikneme na Edit -> Preferences -> Qemu VMs -> New:
-Názov: napr. "Cisco ASA"
-RAM: 256 MB
-Disk image (hda) -> Existing image -> Mikrotik-hda.img
-Finish

7) Vytvorený router pridáme na pracovnú plochu GNS3 a spustíme simuláciu.

#########################################################################

Pridanie Mikrotik routra do GNS3 1.5.2 cez VirtualBox

1) Vo VirtualBoxe vytvoríme novú virtuálnu mašinu:
-Názov: napr. "Mikrotik"
-RAM: 512 MB
-Create new virtual disk -> 512 MB -> Finish
-Finish

2) Vytvorenú virtuálku potrebujeme ešte nastaviť:
-System
  -Acceleration -> Paravirtualization interface -> KVM
  -Mothedboard -> Boot order: Hard disk, CD, všetko ostatné odškrtnuté
  -Processor -> PAE/NX
-Storage -> do virtualnej CD mechaniky namontovať RouterOS iso
-Network -> nastaviť toľko sieťoviek, koľko sa dá (buď NAT alebo Bridged)
-Audio -> odškrtnúť "Enable Audio", inak sa router síce spustí normálne, ale na začiatku napíše chybovú hlášku, že sa nedá inicializovať zvukové zariadenie

3) Inštalácia RouterOS je rovnaká ako pri QEMU metóde. Router je po inštalácií okamžite použiteľný pre simuláciu. Prihlasovacie údaje sú rovnaké ako pre QEMU metódu.

UPOZORNENIE: Hneď po prvom spustení je potrebné zadať licenciu, v opačnom prípade sa router po reštarte / vypnutí a opätovnom zapnutí pri prihlasovacej obrazovke okamžite vypne! Platí pre QEMU aj VirtualBox metódu. Čiastočným riešením pre VirtualBox je vytvorenie snapshotu hneď po inštalácií routra. Pre QEMU je čiastočným riešením preinštalácia systému.

zdroje:
http://brezular.com/2014/07/09/running-mikrotik-routeros-x86-on-gns3/
https://www.youtube.com/watch?v=6h5n67Heao4
https://translate.google.com/translate?hl=en&sl=bg&tl=en&u=https%3A%2F%2Fmikrotik.unibit.bg%2Fnews%2Fgns3-routeros%2F
http://nil.uniza.sk/network-simulation-and-modelling/gns3/making-qemu-mikrotik-router-gns3-under-win7
